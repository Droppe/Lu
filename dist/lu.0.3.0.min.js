/**
 * Lu version 0.3.0
 * @author Robert Martone
 * @license
 *
 * Please thank the contributors:
 * https://github.com/linkedin/Lu/graphs/contributors
 *
 * Copyright (c) 2011,2012 LinkedIn
 * All Rights Reserved. Apache Software License 2.0
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function getComponents(a){var b="components";return a.length>0?a.data(b)||a.data(b,{}).data(b):{}}function getParents(a){return a.parents(Lu.$mapped)}function getDescendants(a){return a.find(Lu.$mapped)}function getChildren(a){return a.children(Lu.$mapped)}function observe(a,b){var c=a.data("$observers");return c?(c=c.add(b.not(c)),a.data("$observers",c),a):a.data("$observers",b)}function unobserve(a,b){var c=a.data("$observers");return c&&(c=c.not(b)),a.data("$observers",c),a}function notify(a,b,c){var d=a.data("$observers");return d&&_.each(d,function(d,e){var f=$(d),g=getComponents(f),h=[];_.each(g,function(d,e){var f=d.deferral;f.then(function(){var e=d.instance;_.indexOf(e.events(),b)>-1&&e.trigger.call(e,new $.Event(b,{target:a}),c)})})}),a}var Lu=function(){var self=this;this.$mapped=$([]),this.map=function($element,component,callback){_.each($element,function(item,index){var $element=$(item),componentData=getComponents($element),settings,configuration,key;self.$mapped=self.$mapped.add($element.not(self.$mapped)),componentData[component]?_.extend(componentData[component].settings,{}):componentData[component]={deferral:$.Deferred(),settings:{}},callback.call(self,$element,componentData[component]),key=componentData[component].key||component;try{configuration=function(){return eval("( function(){ return "+$element.data("luConfig")+"; }() );")}()[key]||{}}catch(error){configuration={}}componentData[component].settings=_.extend(componentData[component].settings,configuration)})},this.execute=function(a){function f(a){var b=getComponents(a);_.each(b,function(b,f){var g="lu/"+f,h=b.settings;_.indexOf(d,g)===-1&&d.push(g),e-=1,c.then(function(c,d,e){var f=require(g);b.instance=new f(a,h),b.hasDependencies?b.instance.one("dependencies-resolved",function(a,c){a.stopPropagation(),b.deferral.resolve(b.instance)}):b.deferral.resolve(b.instance)}),e===0&&require.ensure(d,function(a,b,d){c.resolve(a,b,d)})})}var b=a.find(this.$mapped),c=$.Deferred(),d=[],e;return a.is(this.$mapped)&&(b=b.add(a)),e=b.length,_.each(b,function(a,b){f($(a))}),c}};Lu=window.Lu=new Lu,function(a){a.fn.lu=function(){var b=a(this),c=Array.prototype.slice.call(arguments),d=c[0],e;c[0]=b;switch(d){case"observe":e=observe.apply(b,c);break;case"unobserve":e=unobserve.apply(b,c);break;case"notify":e=notify.apply(b,c);break;case"getComponents":e=getComponents.apply(b,c);break;case"getParents":e=getParents.apply(b,c);break;case"getDescendants":e=getDescendants.apply(b,c);break;case"getChildren":e=getChildren.apply(b,c);break;default:throw new Error("No such method.")}return e}}(window.jQuery),typeof module!="undefined"&&(typeof module.setExports=="function"?module.setExports(Lu):module.exports&&(module.exports=Lu));
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>scripts&#x2F;components&#x2F;Dropdown.js - The Lu Component API</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.7.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.7.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http:&#x2F;&#x2F;use.lu&#x2F;images&#x2F;logo.png" title="The Lu Component API"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.3.x</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/aboveDecorator.html">aboveDecorator</a></li>
            
                <li><a href="..&#x2F;classes/Abstract.html">Abstract</a></li>
            
                <li><a href="..&#x2F;classes/belowDecorator.html">belowDecorator</a></li>
            
                <li><a href="..&#x2F;classes/Button.html">Button</a></li>
            
                <li><a href="..&#x2F;classes/Carousel.html">Carousel</a></li>
            
                <li><a href="..&#x2F;classes/Container.html">Container</a></li>
            
                <li><a href="..&#x2F;classes/DefaultDecorator.html">DefaultDecorator</a></li>
            
                <li><a href="..&#x2F;classes/Dropdown.html">Dropdown</a></li>
            
                <li><a href="..&#x2F;classes/firstDecorator.html">firstDecorator</a></li>
            
                <li><a href="..&#x2F;classes/FormElement.html">FormElement</a></li>
            
                <li><a href="..&#x2F;classes/genericStateDecorator.html">genericStateDecorator</a></li>
            
                <li><a href="..&#x2F;classes/lastDecorator.html">lastDecorator</a></li>
            
                <li><a href="..&#x2F;classes/leftDecorator.html">leftDecorator</a></li>
            
                <li><a href="..&#x2F;classes/List.html">List</a></li>
            
                <li><a href="..&#x2F;classes/loadDecorator.html">loadDecorator</a></li>
            
                <li><a href="..&#x2F;classes/Lu.html">Lu</a></li>
            
                <li><a href="..&#x2F;classes/Mapper.html">Mapper</a></li>
            
                <li><a href="..&#x2F;classes/nextDecorator.html">nextDecorator</a></li>
            
                <li><a href="..&#x2F;classes/pauseDecorator.html">pauseDecorator</a></li>
            
                <li><a href="..&#x2F;classes/Placeholder.html">Placeholder</a></li>
            
                <li><a href="..&#x2F;classes/playDecorator.html">playDecorator</a></li>
            
                <li><a href="..&#x2F;classes/previousDecorator.html">previousDecorator</a></li>
            
                <li><a href="..&#x2F;classes/rightDecorator.html">rightDecorator</a></li>
            
                <li><a href="..&#x2F;classes/selectDecorator.html">selectDecorator</a></li>
            
                <li><a href="..&#x2F;classes/stateDecorator.html">stateDecorator</a></li>
            
                <li><a href="..&#x2F;classes/Switch.html">Switch</a></li>
            
                <li><a href="..&#x2F;classes/Tip.html">Tip</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/Button.html">Button</a></li>
            
                <li><a href="..&#x2F;modules/Lu.html">Lu</a></li>
            
                <li><a href="..&#x2F;modules/Tip.html">Tip</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: scripts&#x2F;components&#x2F;Dropdown.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var constants = require( &#x27;lu&#x2F;constants&#x27; ),
  helpers = require( &#x27;lu&#x2F;helpers&#x27; ),
  Switch = require( &#x27;lu&#x2F;Switch&#x27; ),
  Dropdown;

&#x2F;**
 * Dropdown Lu Control
 * Experimental feature, subject to change
 * @class Dropdown
 * @extends Switch
 * @constructor
 * @version 0.1.0 experimental
 *&#x2F;
Dropdown = Switch.extend( function ( base ) {
  var LIST_ATTR = &#x27;[data-lu=List]&#x27;,
    KEY_EVT = &#x27;keydown&#x27;,
    KEY_ENTER = 13,
    KEY_ESCAPE = 27,
    KEY_UP = 38,
    KEY_DOWN = 40,
    BUTTON_STATE = &#x27;[data-lu=&quot;Button:State&quot;]&#x27;,
    BUTTON_SELECT = &#x27;[data-lu=&quot;Button:Select&quot;]&#x27;,
    TIMER_MS = 250,
    isIgnoredTrigger = false,
    listPrevIndex = 0,
    $listBtn = [],

    &#x2F;**
     * Default configuration values
     * @property defaults
     * @private
     * @type {Object}
     * @final
     *&#x2F;
    defaults = {
      &#x2F;**
       * A selector that matches the button element that will display the selected list item&#x27;s text.
       * Specify Boolean false for no label.
       * @property label
       * @type {Mixed}
       *&#x2F;
      label: BUTTON_STATE + &#x27;:first-child&#x27;,
      &#x2F;**
       * The attribute that contains selected element&#x27;s value.
       * If attribute doesn&#x27;t exist, list item&#x27;s text will be used as value.
       * @property valueAttr
       * @type {String}
       *&#x2F;
      valueAttr: &#x27;data-lu-value&#x27;
    };

  &#x2F;**
   * Arrow key handler
   * @method handleArrowKey
   * @private
   * @param {Number} direction Specifies which list element to select. -1 for previous item, 1 for next list item
   * @param {String} state Dropdown element&#x27;s current state
   *&#x2F;
  function handleArrowKey( direction, state ){
    var list = this.listInstance;

    &#x2F;&#x2F; expand dropdown if inactive
    if( state === constants.states.INACTIVE ){
      this.expand();
    }else{
      isIgnoredTrigger = true;

      &#x2F;&#x2F; up
      if( direction &lt; 0 ){
        if( list.hasPrevious() ){
          list.previous();
        }else{
          list.last();
        }

      &#x2F;&#x2F; down
      }else if( direction &gt; 0 ){
        if( list.hasNext() ){
          list.next();
        }else{
          list.first();
        }
      }
    }
  }

  &#x2F;**
   * Enter key handler
   * @method handleEnterKey
   * @private
   * @param {String} state Dropdown element&#x27;s current state
   *&#x2F;
  function handleEnterKey( state ){
    if( state === constants.states.ACTIVE ){
      update.call( this, true );
    }else if( state === constants.states.INACTIVE ){
      this.expand();
    }
  }

  &#x2F;**
   * Key manager
   * @method handleKeyEvents
   * @private
   * @param {Object} evt Event object
   *&#x2F;
  function handleKeyEvents( evt ){
    var $target = $(evt.target),
      key = evt.keyCode,
      state = this.getState()[0];

    if( !$target.is( this.$element ) &amp;&amp; !$target.is( BUTTON_STATE ) ){
      return;
    }

    switch( key ){
      case KEY_UP:
        handleArrowKey.call( this, -1, state );
        break;

      case KEY_DOWN:
        handleArrowKey.call( this, 1, state );
        break;

      case KEY_ENTER:
        evt.preventDefault();
        handleEnterKey.call( this, state );
        break;

      case KEY_ESCAPE:
        resetList.call( this );
        break;
    }
  }

  &#x2F;**
   * Actions after item has been selected from list
   * @method update
   * @private
   * @param {Boolean} fromKey Is the caller a key handler?
   *&#x2F;
  function update( fromKey ){
    var href,
      index = this.listInstance.index();

    $listBtn = this.listInstance.current().$element.find( BUTTON_SELECT );

    setLabel.call( this );

    if( index !== listPrevIndex ){
      listPrevIndex = index;
      this.trigger( constants.events.UPDATED, this );
    }

    this.collapse();

    &#x2F;&#x2F; follow link if triggered by enter key
    if( fromKey &amp;&amp; $listBtn.is( &#x27;a&#x27; ) ){
      href = $listBtn.attr( &#x27;href&#x27; );
      window.location.href = href;
    }
  }

  &#x2F;**
   * Updates dropwdown label with text from list item
   * @method setLabel
   * @private
   *&#x2F;
  function setLabel(){
    if( this.$label.length &gt; 0 &amp;&amp; $listBtn.length &gt; 0 ){
      this.$label.html( $listBtn.html() );
    }
  }

  &#x2F;**
   * Reset list to original state when no selections are made
   * @method resetList
   * @private
   *&#x2F;
  function resetList(){
    isIgnoredTrigger = true;

    this.listInstance.select( listPrevIndex );
    this.collapse();
  }

  &#x2F;&#x2F; RETURN METHODS OBJECT
  return {
    &#x2F;**
     * Class constructor
     * @method initialize
     * @public
     * @param {Object} $element JQuery object for the element wrapped by the component
     * @param {Object} settings Configuration settings
     *&#x2F;
    init: function ( $element, settings ){
      var $list = $element.find( LIST_ATTR ),
        listComponent,
        timer,
        self = this;

      _.defaults( settings, defaults );
      base.init.call( this, $element, settings );

      if( $list.length &lt; 1 ){
        return;
      }

      listComponent = $list.lu(&#x27;getComponents&#x27;).List;

      self.$stateButton = $element.find( BUTTON_STATE );
      self.$label = ( typeof settings.label !== &#x27;undefined&#x27; || settings.label !== false ) ? $element.find( settings.label ) : [];
      self.valueAttr = settings.valueAttr;

      &#x2F;&#x2F; get reference of list component instance
      listComponent.deferral.then( function(){
        self.listInstance = listComponent.instance;
        listPrevIndex = self.listInstance.index();

        self.listInstance.on( constants.events.SELECTED, function( evt, component ){
          &#x2F;&#x2F; prevent updates on arrow key events
          if( !isIgnoredTrigger ){
            update.call( self );
          }
          
          isIgnoredTrigger = false;
        } );
      } );

      &#x2F;&#x2F; keydown event handler
      self.$element.on( KEY_EVT, function(){
        handleKeyEvents.apply( self, arguments );
      } );

      &#x2F;&#x2F; force collapse when dropdown loses focus
      self.$element.on( &#x27;focusin&#x27;, function( evt ){
        var $tget = $( evt.target );

        if( $tget.closest( self.$element ) ){
          clearTimeout( timer );
        }
      } );

      self.$element.on( &#x27;focusout&#x27;, function( evt ){
        timer = setTimeout( function(){
          resetList.call( self );
        }, TIMER_MS );
      } );
    },

    &#x2F;**
     * Sets dropdown to expanded state
     * @method expand
     * @public
     *&#x2F;
    expand: function(){
      this.setState( constants.states.ACTIVE );
    },

    &#x2F;**
     * Sets dropdown to collapsed state
     * @method collapse
     * @public
     *&#x2F;
    collapse: function(){
      this.setState( constants.states.INACTIVE );
    },

    &#x2F;**
     * Get the dropdown&#x27;s selected value
     * @method getValue
     * @public
     * @return {String} value Selected value
     *&#x2F;
    getValue: function(){
      var value = &#x27;&#x27;;

      if( typeof $listBtn.attr( this.valueAttr ) !== &#x27;undefined&#x27; ){
        value = $listBtn.attr( this.valueAttr );
      }else{
        value = $listBtn.text();
      }

      return value;
    }
  };

} );

&#x2F;&#x2F;Export to Common JS Loader
if( typeof module !== &#x27;undefined&#x27; ){
  if( typeof module.setExports === &#x27;function&#x27; ){
    module.setExports( Dropdown );
  } else if( module.exports ){
   module.exports = Dropdown;
  }
}

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
